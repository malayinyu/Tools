<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excelæ™ºèƒ½æ‹†åˆ†å·¥å…·</title>
    
    <!-- CDNå¼•å…¥ -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* è‡ªå®šä¹‰ç»ç’ƒæ‹Ÿæ€æ•ˆæœ */
        .glass {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .glass-dark {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .drop-zone {
            border: 2px dashed rgba(59, 130, 246, 0.5);
            transition: all 0.3s ease;
        }
        
        .drop-zone.dragover {
            border-color: rgba(59, 130, 246, 0.8);
            background-color: rgba(59, 130, 246, 0.05);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-text {
            background: linear-gradient(to right, #667eea, #764ba2);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 4px;
            background: linear-gradient(to right, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        /* æ–°å¹´æ°›å›´åŠ¨ç”»æ ·å¼ */
        .success-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        
        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background-color: #ff0000;
            box-shadow: 
                0 0 10px 2px #ff0000,
                0 0 20px 4px #ff9900;
        }
        
        .firework.red {
            background-color: #ff0000;
            box-shadow: 
                0 0 10px 2px #ff0000,
                0 0 20px 4px #ff9900;
        }
        
        .firework.gold {
            background-color: #ffd700;
            box-shadow: 
                0 0 10px 2px #ffd700,
                0 0 20px 4px #ff9900;
        }
        
        .firework.green {
            background-color: #00ff00;
            box-shadow: 
                0 0 10px 2px #00ff00,
                0 0 20px 4px #00cc00;
        }
        
        @keyframes firework-explode {
            0% { 
                transform: translate(0, 0) scale(1); 
                opacity: 1;
            }
            100% { 
                transform: translate(var(--tx), var(--ty)) scale(0); 
                opacity: 0;
            }
        }
        
        .success-card {
            position: relative;
            z-index: 10;
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.9), rgba(255, 215, 0, 0.9));
            border-radius: 20px;
            padding: 60px 80px;
            text-align: center;
            box-shadow: 
                0 0 50px rgba(255, 0, 0, 0.5),
                0 0 100px rgba(255, 215, 0, 0.3),
                inset 0 0 20px rgba(255, 255, 255, 0.5);
            animation: cardPulse 2s infinite alternate;
            border: 3px solid #ffd700;
        }
        
        @keyframes cardPulse {
            0% { 
                transform: scale(1);
                box-shadow: 
                    0 0 50px rgba(255, 0, 0, 0.5),
                    0 0 100px rgba(255, 215, 0, 0.3),
                    inset 0 0 20px rgba(255, 255, 255, 0.5);
            }
            100% { 
                transform: scale(1.05);
                box-shadow: 
                    0 0 60px rgba(255, 0, 0, 0.7),
                    0 0 120px rgba(255, 215, 0, 0.5),
                    inset 0 0 30px rgba(255, 255, 255, 0.7);
            }
        }
        
        .success-text {
            font-size: 64px;
            font-weight: bold;
            color: #fff;
            text-shadow: 
                0 0 10px #ff0000,
                0 0 20px #ff9900,
                0 0 30px #ffd700;
            letter-spacing: 4px;
            margin-bottom: 20px;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        .sub-text {
            font-size: 24px;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            margin-bottom: 30px;
        }
        
        .new-year-decoration {
            position: absolute;
            font-size: 36px;
            color: #ffd700;
            animation: rotate 10s linear infinite;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .lantern {
            position: absolute;
            width: 40px;
            height: 60px;
            background: linear-gradient(to bottom, #ff0000, #cc0000);
            border-radius: 20px 20px 10px 10px;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.7);
            animation: lanternSwing 3s ease-in-out infinite alternate;
        }
        
        .lantern:before {
            content: '';
            position: absolute;
            top: -10px;
            left: 10px;
            width: 20px;
            height: 10px;
            background: #ffd700;
            border-radius: 5px 5px 0 0;
        }
        
        .lantern:after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 15px;
            width: 10px;
            height: 15px;
            background: #ffd700;
            border-radius: 0 0 5px 5px;
        }
        
        @keyframes lanternSwing {
            0% { transform: translateX(0) rotate(-5deg); }
            100% { transform: translateX(20px) rotate(5deg); }
        }
        
        .close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #fff;
            color: #fff;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 100;
        }
        
        .close-button:hover {
            background: rgba(255, 0, 0, 0.7);
            transform: scale(1.1);
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
        }
        
        @keyframes confettiFall {
            0% { 
                opacity: 1;
                transform: translateY(-100px) rotate(0deg); 
            }
            100% { 
                opacity: 0;
                transform: translateY(1000px) rotate(720deg); 
            }
        }
        
        /* Sheeté¢„è§ˆè¡¨æ ¼æ ·å¼ */
        .sheet-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .sheet-table th {
            background-color: rgba(30, 41, 59, 0.8);
            color: #cbd5e1;
            font-weight: 600;
            padding: 6px 8px;
            text-align: left;
            border: 1px solid rgba(100, 116, 139, 0.5);
            white-space: nowrap;
        }
        
        .sheet-table td {
            padding: 6px 8px;
            border: 1px solid rgba(100, 116, 139, 0.3);
            color: #e2e8f0;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .sheet-table tr:nth-child(even) {
            background-color: rgba(30, 41, 59, 0.4);
        }
        
        .sheet-table tr:hover {
            background-color: rgba(59, 130, 246, 0.2);
        }
        
        .sheet-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .sheet-tab {
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            background-color: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(100, 116, 139, 0.3);
            color: #cbd5e1;
        }
        
        .sheet-tab:hover {
            background-color: rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.5);
        }
        
        .sheet-tab.active {
            background-color: rgba(59, 130, 246, 0.7);
            border-color: rgba(59, 130, 246, 0.9);
            color: white;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }
        
        .preview-container {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 8px;
            border: 1px solid rgba(100, 116, 139, 0.3);
            background-color: rgba(15, 23, 42, 0.6);
        }
        
        .preview-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background-color: rgba(30, 41, 59, 0.7);
            border-bottom: 1px solid rgba(100, 116, 139, 0.3);
            font-size: 14px;
            color: #cbd5e1;
        }
        
        .preview-info span {
            font-weight: 600;
            color: #60a5fa;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen p-4 md:p-8">
    <div id="root" class="max-w-6xl mx-auto"></div>
    
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        
        // æ–°å¹´æˆåŠŸåŠ¨ç”»ç»„ä»¶
        function SuccessAnimation({ onClose }) {
            const [fireworks, setFireworks] = useState([]);
            const [confetti, setConfetti] = useState([]);
            const animationRef = useRef(null);
            
            // åˆ›å»ºçƒŸèŠ±æ•ˆæœ
            useEffect(() => {
                // åˆ›å»ºåˆå§‹çƒŸèŠ±
                const initialFireworks = [];
                for (let i = 0; i < 50; i++) {
                    initialFireworks.push({
                        id: i,
                        x: Math.random() * 100,
                        y: Math.random() * 100,
                        color: i % 3 === 0 ? 'red' : (i % 3 === 1 ? 'gold' : 'green'),
                        tx: (Math.random() - 0.5) * 200,
                        ty: (Math.random() - 0.5) * 200,
                        delay: Math.random() * 2
                    });
                }
                setFireworks(initialFireworks);
                
                // åˆ›å»ºå½©è‰²çº¸å±‘
                const initialConfetti = [];
                const colors = ['#ff0000', '#ff9900', '#ffff00', '#00ff00', '#0099ff', '#9900ff'];
                for (let i = 0; i < 200; i++) {
                    initialConfetti.push({
                        id: i,
                        x: Math.random() * 100,
                        y: -10,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        delay: Math.random() * 5,
                        duration: 2 + Math.random() * 3
                    });
                }
                setConfetti(initialConfetti);
                
                // 5ç§’åè‡ªåŠ¨å…³é—­
                const timer = setTimeout(() => {
                    onClose();
                }, 5000);
                
                return () => clearTimeout(timer);
            }, [onClose]);
            
            // ç¯ç¬¼ä½ç½®
            const lanterns = [
                { left: '10%', top: '10%' },
                { left: '85%', top: '15%' },
                { left: '15%', top: '80%' },
                { left: '80%', top: '85%' }
            ];
            
            return ReactDOM.createPortal(
                <div className="success-animation">
                    {/* å…³é—­æŒ‰é’® */}
                    <div className="close-button" onClick={onClose}>Ã—</div>
                    
                    {/* ç¯ç¬¼è£…é¥° */}
                    {lanterns.map((pos, idx) => (
                        <div 
                            key={`lantern-${idx}`}
                            className="lantern"
                            style={{ left: pos.left, top: pos.top }}
                        />
                    ))}
                    
                    {/* çƒŸèŠ±æ•ˆæœ */}
                    {fireworks.map(fire => (
                        <div 
                            key={fire.id}
                            className={`firework ${fire.color}`}
                            style={{
                                left: `${fire.x}%`,
                                top: `${fire.y}%`,
                                '--tx': `${fire.tx}px`,
                                '--ty': `${fire.ty}px`,
                                animation: `firework-explode 1s ease-out ${fire.delay}s forwards`
                            }}
                        />
                    ))}
                    
                    {/* å½©è‰²çº¸å±‘ */}
                    {confetti.map(conf => (
                        <div 
                            key={conf.id}
                            className="confetti"
                            style={{
                                left: `${conf.x}%`,
                                top: `${conf.y}%`,
                                backgroundColor: conf.color,
                                animation: `confettiFall ${conf.duration}s ease-in ${conf.delay}s forwards`
                            }}
                        />
                    ))}
                    
                    {/* æ–°å¹´è£…é¥°æ–‡å­— */}
                    <div className="new-year-decoration" style={{ top: '20%', left: '5%' }}>ğŸ‰</div>
                    <div className="new-year-decoration" style={{ top: '10%', right: '10%' }}>âœ¨</div>
                    <div className="new-year-decoration" style={{ bottom: '20%', left: '10%' }}>ğŸ§¨</div>
                    <div className="new-year-decoration" style={{ bottom: '15%', right: '5%' }}>ğŸ§§</div>
                    
                    {/* æˆåŠŸå¡ç‰‡ */}
                    <div className="success-card">
                        <div className="success-text">æ‹†åˆ†æˆåŠŸï¼</div>
                        <div className="sub-text">Excelæ–‡ä»¶å·²æ‹†åˆ†å®Œæˆï¼Œè¯·æŸ¥æ”¶ä¸‹è½½çš„æ–‡ä»¶</div>
                        <div className="flex justify-center space-x-4 mt-6">
                            <div className="text-3xl">ğŸŠ</div>
                            <div className="text-3xl">ğŸ‡</div>
                            <div className="text-3xl">ğŸ†</div>
                            <div className="text-3xl">ğŸ§¨</div>
                            <div className="text-3xl">ğŸ</div>
                        </div>
                        <div className="mt-8 text-white text-lg">
                            ç¥æ‚¨æ–°å¹´å¿«ä¹ï¼Œå·¥ä½œé¡ºåˆ©ï¼
                        </div>
                    </div>
                </div>,
                document.body
            );
        }
        
        // Sheeté¢„è§ˆç»„ä»¶
        function SheetPreview({ sheetData, sheetName, rowCount, colCount }) {
            // åªæ˜¾ç¤ºå‰10è¡Œå’Œå‰10åˆ—ä½œä¸ºé¢„è§ˆ
            const previewRows = Math.min(10, rowCount);
            const previewCols = Math.min(10, colCount);
            
            if (!sheetData || sheetData.length === 0) {
                return (
                    <div className="p-8 text-center text-gray-400">
                        <p>è¯¥Sheetæ²¡æœ‰æ•°æ®æˆ–æ•°æ®ä¸ºç©º</p>
                    </div>
                );
            }
            
            // è·å–è¡¨å¤´
            const headers = sheetData[0] || [];
            
            // è·å–é¢„è§ˆæ•°æ®
            const previewData = sheetData.slice(0, previewRows + 1); // +1 åŒ…å«è¡¨å¤´
            
            return (
                <div className="preview-container">
                    <div className="preview-info">
                        <div>
                            Sheetåç§°: <span>{sheetName}</span>
                        </div>
                        <div>
                            æ•°æ®é¢„è§ˆ: <span>å‰{previewRows}è¡Œ / å‰{previewCols}åˆ—</span>
                        </div>
                        <div>
                            æ€»æ•°æ®: <span>{rowCount}è¡Œ Ã— {colCount}åˆ—</span>
                        </div>
                    </div>
                    
                    <table className="sheet-table">
                        <thead>
                            <tr>
                                {headers.slice(0, previewCols).map((header, idx) => (
                                    <th key={idx}>
                                        {header || `åˆ—${idx + 1}`}
                                    </th>
                                ))}
                                {colCount > previewCols && (
                                    <th>...</th>
                                )}
                            </tr>
                        </thead>
                        <tbody>
                            {previewData.slice(1).map((row, rowIdx) => (
                                <tr key={rowIdx}>
                                    {row.slice(0, previewCols).map((cell, cellIdx) => (
                                        <td key={cellIdx} title={cell}>
                                            {cell !== null && cell !== undefined ? cell.toString() : ''}
                                        </td>
                                    ))}
                                    {colCount > previewCols && (
                                        <td>...</td>
                                    )}
                                </tr>
                            ))}
                            {rowCount > previewRows && (
                                <tr>
                                    <td colSpan={previewCols + (colCount > previewCols ? 1 : 0)} className="text-center text-gray-400">
                                        ... è¿˜æœ‰ {rowCount - previewRows} è¡Œæ•°æ®æœªæ˜¾ç¤º
                                    </td>
                                </tr>
                            )}
                        </tbody>
                    </table>
                </div>
            );
        }
        
        // ä¸»åº”ç”¨ç»„ä»¶
        function App() {
            const [file, setFile] = useState(null);
            const [maxRows, setMaxRows] = useState(1000);
            const [status, setStatus] = useState('ç­‰å¾…ä¸Šä¼ æ–‡ä»¶'); // waiting, processing, completed, error
            const [progress, setProgress] = useState(0);
            const [resultInfo, setResultInfo] = useState(null);
            const [isDragging, setIsDragging] = useState(false);
            const [concurrency, setConcurrency] = useState(10);
            const [isProcessing, setIsProcessing] = useState(false);
            const [errorMessage, setErrorMessage] = useState('');
            const [showSuccessAnimation, setShowSuccessAnimation] = useState(false);
            
            // æ–°å¢çŠ¶æ€ï¼šSheetç›¸å…³
            const [sheets, setSheets] = useState([]); // [{name: 'Sheet1', data: [], rows: 0, cols: 0}, ...]
            const [selectedSheetIndex, setSelectedSheetIndex] = useState(0);
            const [workbook, setWorkbook] = useState(null);
            
            const fileInputRef = useRef(null);
            
            // å¤„ç†æ–‡ä»¶æ‹–æ”¾
            const handleDragOver = (e) => {
                e.preventDefault();
                setIsDragging(true);
            };
            
            const handleDragLeave = (e) => {
                e.preventDefault();
                setIsDragging(false);
            };
            
            const handleDrop = (e) => {
                e.preventDefault();
                setIsDragging(false);
                
                const droppedFile = e.dataTransfer.files[0];
                if (droppedFile) {
                    handleFileSelect(droppedFile);
                }
            };
            
            // å¤„ç†æ–‡ä»¶é€‰æ‹©
            const handleFileSelect = (selectedFile) => {
                // éªŒè¯æ–‡ä»¶ç±»å‹
                const validTypes = [
                    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                    'application/vnd.ms-excel',
                    'text/csv',
                    'application/vnd.oasis.opendocument.spreadsheet'
                ];
                
                if (!validTypes.includes(selectedFile.type) && 
                    !selectedFile.name.match(/\.(xlsx|xls|csv|ods)$/i)) {
                    setStatus('error');
                    setErrorMessage('è¯·ä¸Šä¼ æœ‰æ•ˆçš„Excelæ–‡ä»¶ (xlsx, xls, csv, ods)');
                    return;
                }
                
                setFile(selectedFile);
                setStatus('æ–‡ä»¶å·²ä¸Šä¼ ');
                setErrorMessage('');
                
                // è¯»å–Excelæ–‡ä»¶å¹¶è§£ææ‰€æœ‰Sheet
                readExcelSheets(selectedFile);
            };
            
            // è¯»å–Excelæ–‡ä»¶çš„æ‰€æœ‰Sheet
            const readExcelSheets = (excelFile) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const wb = XLSX.read(data, { type: 'array' });
                        setWorkbook(wb);
                        
                        const sheetNames = wb.SheetNames;
                        const sheetDataList = [];
                        
                        // é™åˆ¶æœ€å¤šé¢„è§ˆ10ä¸ªSheetï¼Œé¿å…æ€§èƒ½é—®é¢˜
                        const maxSheetsToPreview = Math.min(sheetNames.length, 10);
                        
                        for (let i = 0; i < maxSheetsToPreview; i++) {
                            const sheetName = sheetNames[i];
                            const worksheet = wb.Sheets[sheetName];
                            
                            // å°†å·¥ä½œè¡¨æ•°æ®è½¬æ¢ä¸ºJSONæ•°ç»„
                            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                            
                            // è®¡ç®—è¡Œæ•°å’Œåˆ—æ•°
                            let rowCount = jsonData.length;
                            let colCount = 0;
                            if (rowCount > 0) {
                                // æ‰¾å‡ºæœ€å¤§åˆ—æ•°
                                colCount = jsonData.reduce((max, row) => Math.max(max, row.length), 0);
                            }
                            
                            // å¦‚æœæ•°æ®ä¸ºç©ºï¼Œè¡Œæ•°è®¾ä¸º0ï¼ˆä¸åŒ…æ‹¬è¡¨å¤´ï¼‰
                            const dataRowCount = Math.max(0, rowCount - 1);
                            
                            sheetDataList.push({
                                name: sheetName,
                                data: jsonData,
                                rows: dataRowCount,
                                cols: colCount,
                                index: i
                            });
                        }
                        
                        setSheets(sheetDataList);
                        
                        if (sheetDataList.length > 0) {
                            setSelectedSheetIndex(0);
                            setStatus('è¯·é€‰æ‹©è¦æ‹†åˆ†çš„Sheet');
                        } else {
                            setStatus('error');
                            setErrorMessage('Excelæ–‡ä»¶ä¸­æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„Sheet');
                        }
                        
                    } catch (error) {
                        setStatus('error');
                        setErrorMessage('è§£æExcelæ–‡ä»¶æ—¶å‡ºé”™: ' + error.message);
                    }
                };
                
                reader.onerror = function() {
                    setStatus('error');
                    setErrorMessage('è¯»å–æ–‡ä»¶æ—¶å‡ºé”™');
                };
                
                reader.readAsArrayBuffer(excelFile);
            };
            
            // å¤„ç†æ–‡ä»¶è¾“å…¥å˜åŒ–
            const handleFileInputChange = (e) => {
                const selectedFile = e.target.files[0];
                if (selectedFile) {
                    handleFileSelect(selectedFile);
                }
            };
            
            // è§¦å‘æ–‡ä»¶é€‰æ‹©
            const triggerFileInput = () => {
                fileInputRef.current.click();
            };
            
            // é€‰æ‹©Sheet
            const selectSheet = (index) => {
                setSelectedSheetIndex(index);
            };
            
            // å¤„ç†æ‹†åˆ†Excel
            const handleSplitExcel = async () => {
                if (!file || !workbook) {
                    setStatus('error');
                    setErrorMessage('è¯·å…ˆä¸Šä¼ Excelæ–‡ä»¶');
                    return;
                }
                
                if (sheets.length === 0) {
                    setStatus('error');
                    setErrorMessage('æ²¡æœ‰å¯ç”¨çš„Sheet');
                    return;
                }
                
                if (maxRows < 1) {
                    setStatus('error');
                    setErrorMessage('æ¯è¡¨æœ€å¤§è¡Œæ•°å¿…é¡»å¤§äº0');
                    return;
                }
                
                setIsProcessing(true);
                setStatus('processing');
                setProgress(0);
                setErrorMessage('');
                
                try {
                    const selectedSheet = sheets[selectedSheetIndex];
                    const sheetName = selectedSheet.name;
                    
                    // è·å–é€‰ä¸­çš„å·¥ä½œè¡¨
                    const worksheet = workbook.Sheets[sheetName];
                    
                    // å°†å·¥ä½œè¡¨æ•°æ®è½¬æ¢ä¸ºJSONæ•°ç»„
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    // è·å–è¡¨å¤´ï¼ˆç¬¬ä¸€è¡Œï¼‰
                    const headers = jsonData[0] || [];
                    
                    // è·å–æ•°æ®è¡Œï¼ˆé™¤è¡¨å¤´å¤–çš„æ‰€æœ‰è¡Œï¼‰
                    const dataRows = jsonData.slice(1);
                    const totalRows = dataRows.length;
                    
                    // è®¡ç®—éœ€è¦æ‹†åˆ†çš„è¡¨æ ¼æ•°é‡
                    const tablesCount = Math.ceil(totalRows / maxRows);
                    
                    setProgress(20);
                    
                    // åˆ›å»ºZIPæ–‡ä»¶
                    const zip = new JSZip();
                    
                    // è·å–å½“å‰æ—¥æœŸ
                    const today = new Date();
                    const dateStr = today.getFullYear().toString() + 
                                  (today.getMonth() + 1).toString().padStart(2, '0') + 
                                  today.getDate().toString().padStart(2, '0');
                    
                    // æ‹†åˆ†å¹¶åˆ›å»ºå¤šä¸ªExcelæ–‡ä»¶
                    for (let i = 0; i < tablesCount; i++) {
                        const startRow = i * maxRows;
                        const endRow = Math.min(startRow + maxRows, totalRows);
                        const currentRows = dataRows.slice(startRow, endRow);
                        
                        // åˆ›å»ºæ–°çš„å·¥ä½œè¡¨æ•°æ®ï¼ˆåŒ…å«è¡¨å¤´ï¼‰
                        const newSheetData = [headers, ...currentRows];
                        
                        // åˆ›å»ºæ–°çš„å·¥ä½œè¡¨
                        const newWorksheet = XLSX.utils.aoa_to_sheet(newSheetData);
                        
                        // åˆ›å»ºæ–°çš„å·¥ä½œç°¿
                        const newWorkbook = XLSX.utils.book_new();
                        XLSX.utils.book_append_sheet(newWorkbook, newWorksheet, sheetName);
                        
                        // å°†å·¥ä½œç°¿è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°æ®
                        const wbout = XLSX.write(newWorkbook, { bookType: 'xlsx', type: 'array' });
                        
                        // æ·»åŠ åˆ°ZIP
                        const fileName = `è¡¨æ ¼æ‹†åˆ†-${dateStr}-${sheetName}-ç¬¬${i+1}ä¸ª-å…±${currentRows.length+1}è¡Œ.xlsx`;
                        zip.file(fileName, wbout);
                        
                        // æ›´æ–°è¿›åº¦
                        setProgress(20 + Math.floor((i + 1) / tablesCount * 70));
                    }
                    
                    setProgress(95);
                    
                    // ç”ŸæˆZIPæ–‡ä»¶å¹¶è§¦å‘ä¸‹è½½
                    zip.generateAsync({ type: 'blob' })
                        .then(function(content) {
                            // ä¿å­˜æ–‡ä»¶
                            saveAs(content, `è¡¨æ ¼æ‹†åˆ†-${dateStr}-${sheetName}.zip`);
                            
                            // æ›´æ–°çŠ¶æ€
                            setProgress(100);
                            setStatus('completed');
                            setIsProcessing(false);
                            
                            // è®¾ç½®ç»“æœä¿¡æ¯
                            setResultInfo({
                                originalFile: file.name,
                                sheetName: sheetName,
                                tablesCount: tablesCount,
                                totalRows: totalRows,
                                maxRows: maxRows,
                                date: dateStr
                            });
                            
                            // æ˜¾ç¤ºæˆåŠŸåŠ¨ç”»
                            setShowSuccessAnimation(true);
                        })
                        .catch(function(error) {
                            setStatus('error');
                            setErrorMessage('ç”Ÿæˆå‹ç¼©åŒ…æ—¶å‡ºé”™: ' + error.message);
                            setIsProcessing(false);
                        });
                        
                } catch (error) {
                    setStatus('error');
                    setErrorMessage('å¤„ç†Excelæ–‡ä»¶æ—¶å‡ºé”™: ' + error.message);
                    setIsProcessing(false);
                }
            };
            
            // é‡ç½®çŠ¶æ€
            const handleReset = () => {
                setFile(null);
                setStatus('ç­‰å¾…ä¸Šä¼ æ–‡ä»¶');
                setProgress(0);
                setResultInfo(null);
                setErrorMessage('');
                setSheets([]);
                setSelectedSheetIndex(0);
                setWorkbook(null);
                if (fileInputRef.current) {
                    fileInputRef.current.value = '';
                }
            };
            
            // å…³é—­æˆåŠŸåŠ¨ç”»
            const closeSuccessAnimation = () => {
                setShowSuccessAnimation(false);
            };
            
            // æ¸²æŸ“çŠ¶æ€æŒ‡ç¤ºå™¨
            const renderStatusIndicator = () => {
                switch(status) {
                    case 'ç­‰å¾…ä¸Šä¼ æ–‡ä»¶':
                        return <div className="flex items-center text-blue-400">
                            <div className="w-3 h-3 rounded-full bg-blue-400 mr-2"></div>
                            <span>ç­‰å¾…ä¸Šä¼ æ–‡ä»¶</span>
                        </div>;
                    case 'æ–‡ä»¶å·²ä¸Šä¼ ':
                    case 'è¯·é€‰æ‹©è¦æ‹†åˆ†çš„Sheet':
                        return <div className="flex items-center text-green-400">
                            <div className="w-3 h-3 rounded-full bg-green-400 mr-2"></div>
                            <span>{status}: {file?.name}</span>
                        </div>;
                    case 'processing':
                        return <div className="flex items-center text-yellow-400">
                            <div className="w-3 h-3 rounded-full bg-yellow-400 mr-2 pulse"></div>
                            <span>æ­£åœ¨å¤„ç†ä¸­...</span>
                        </div>;
                    case 'completed':
                        return <div className="flex items-center text-green-400">
                            <div className="w-3 h-3 rounded-full bg-green-400 mr-2"></div>
                            <span>å¤„ç†å®Œæˆï¼</span>
                        </div>;
                    case 'error':
                        return <div className="flex items-center text-red-400">
                            <div className="w-3 h-3 rounded-full bg-red-400 mr-2"></div>
                            <span>å¤„ç†å‡ºé”™</span>
                        </div>;
                    default:
                        return null;
                }
            };
            
            return (
                <div className="space-y-8">
                    {/* æ–°å¹´æˆåŠŸåŠ¨ç”» */}
                    {showSuccessAnimation && (
                        <SuccessAnimation onClose={closeSuccessAnimation} />
                    )}
                    
                    {/* æ ‡é¢˜ */}
                    <div className="text-center">
                        <h1 className="text-3xl md:text-4xl font-bold text-white mb-2">Excelæ™ºèƒ½æ‹†åˆ†å·¥å…·</h1>
                        <p className="text-gray-200">æ”¯æŒå¤šSheeté€‰æ‹©é¢„è§ˆï¼ŒæŒ‰æŒ‡å®šè¡Œæ•°æ‹†åˆ†Excelæ–‡ä»¶</p>
                    </div>
                    
                    {/* ä¸»å¡ç‰‡ */}
                    <div className="glass-dark p-6 md:p-8">
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* å·¦ä¾§ï¼šä¸Šä¼ åŒºåŸŸ */}
                            <div className="lg:col-span-2">
                                <div 
                                    className={`drop-zone p-8 rounded-2xl text-center cursor-pointer transition-all duration-300 ${isDragging ? 'dragover' : ''} ${file ? 'bg-slate-800/30' : 'glass'}`}
                                    onDragOver={handleDragOver}
                                    onDragLeave={handleDragLeave}
                                    onDrop={handleDrop}
                                    onClick={triggerFileInput}
                                >
                                    <input 
                                        type="file" 
                                        ref={fileInputRef}
                                        className="hidden" 
                                        accept=".xlsx,.xls,.csv,.ods"
                                        onChange={handleFileInputChange}
                                    />
                                    
                                    <div className="mb-6">
                                        <div className="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 mb-4">
                                            <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                            </svg>
                                        </div>
                                        <h3 className="text-xl font-bold text-white mb-2">ä¸Šä¼ Excelæ–‡ä»¶</h3>
                                        <p className="text-gray-300 mb-4">æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                                        <p className="text-sm text-gray-400">æ”¯æŒ .xlsx, .xls, .csv, .ods æ ¼å¼</p>
                                    </div>
                                    
                                    {file && (
                                        <div className="mt-6 p-4 bg-slate-800/50 rounded-xl">
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center">
                                                    <svg className="w-6 h-6 text-green-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                    </svg>
                                                    <div>
                                                        <p className="font-medium text-white">{file.name}</p>
                                                        <p className="text-sm text-gray-300">{(file.size / 1024).toFixed(2)} KB</p>
                                                    </div>
                                                </div>
                                                <button 
                                                    onClick={(e) => { e.stopPropagation(); handleReset(); }}
                                                    className="p-2 text-gray-400 hover:text-white transition-colors"
                                                >
                                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path>
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    )}
                                </div>
                                
                                {/* Sheeté€‰æ‹©åŒºåŸŸ */}
                                {sheets.length > 0 && (
                                    <div className="mt-8 glass p-6 rounded-2xl">
                                        <h3 className="text-lg font-bold text-white mb-4">é€‰æ‹©è¦æ‹†åˆ†çš„Sheet</h3>
                                        
                                        <div className="sheet-tabs">
                                            {sheets.map((sheet, index) => (
                                                <div 
                                                    key={index}
                                                    className={`sheet-tab ${selectedSheetIndex === index ? 'active' : ''}`}
                                                    onClick={() => selectSheet(index)}
                                                >
                                                    {sheet.name} ({sheet.rows}è¡Œ)
                                                </div>
                                            ))}
                                        </div>
                                        
                                        {/* Sheeté¢„è§ˆ */}
                                        {sheets[selectedSheetIndex] && (
                                            <SheetPreview 
                                                sheetData={sheets[selectedSheetIndex].data}
                                                sheetName={sheets[selectedSheetIndex].name}
                                                rowCount={sheets[selectedSheetIndex].rows}
                                                colCount={sheets[selectedSheetIndex].cols}
                                            />
                                        )}
                                    </div>
                                )}
                            </div>
                            
                            {/* å³ä¾§ï¼šé…ç½®åŒºåŸŸ */}
                            <div className="space-y-6">
                                <div className="glass p-5 rounded-2xl">
                                    <h3 className="text-lg font-bold text-white mb-4">æ‹†åˆ†é…ç½®</h3>
                                    
                                    <div className="space-y-5">
                                        <div>
                                            <label className="block text-gray-300 mb-2">æ¯è¡¨æœ€å¤§æ•°æ®è¡Œæ•°</label>
                                            <div className="flex items-center">
                                                <input 
                                                    type="number" 
                                                    min="1" 
                                                    max="100000"
                                                    value={maxRows}
                                                    onChange={(e) => setMaxRows(parseInt(e.target.value) || 1000)}
                                                    className="w-full p-3 bg-slate-800/50 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                />
                                            </div>
                                            <p className="text-sm text-gray-400 mt-1">åŒ…æ‹¬è¡¨å¤´ï¼Œæ¯ä¸ªæ‹†åˆ†åçš„è¡¨æ ¼æœ€å¤šåŒ…å«çš„è¡Œæ•°</p>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-gray-300 mb-2">å¹¶å‘å¤„ç†æ•°</label>
                                            <div className="flex items-center">
                                                <input 
                                                    type="number" 
                                                    min="1" 
                                                    max="50"
                                                    value={concurrency}
                                                    onChange={(e) => setConcurrency(parseInt(e.target.value) || 10)}
                                                    className="w-full p-3 bg-slate-800/50 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                />
                                            </div>
                                            <p className="text-sm text-gray-400 mt-1">åŒæ—¶å¤„ç†çš„ä»»åŠ¡æ•°é‡ï¼Œé»˜è®¤ä¸º10</p>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* çŠ¶æ€æ˜¾ç¤º */}
                                <div className="glass p-5 rounded-2xl">
                                    <h3 className="text-lg font-bold text-white mb-4">å¤„ç†çŠ¶æ€</h3>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            {renderStatusIndicator()}
                                        </div>
                                        
                                        {errorMessage && (
                                            <div className="p-3 bg-red-900/30 border border-red-700/50 rounded-lg">
                                                <p className="text-red-300 text-sm">{errorMessage}</p>
                                            </div>
                                        )}
                                        
                                        {/* è¿›åº¦æ¡ */}
                                        {isProcessing && (
                                            <div>
                                                <div className="flex justify-between text-sm text-gray-300 mb-1">
                                                    <span>å¤„ç†è¿›åº¦</span>
                                                    <span>{progress}%</span>
                                                </div>
                                                <div className="progress-bar">
                                                    <div className="progress-fill" style={{ width: `${progress}%` }}></div>
                                                </div>
                                            </div>
                                        )}
                                        
                                        {/* ç»“æœä¿¡æ¯ */}
                                        {resultInfo && (
                                            <div className="p-3 bg-green-900/20 border border-green-700/30 rounded-lg">
                                                <h4 className="font-medium text-green-300 mb-2">æ‹†åˆ†å®Œæˆ</h4>
                                                <div className="text-sm space-y-1">
                                                    <p className="text-gray-300">åŸæ–‡ä»¶: <span className="text-white">{resultInfo.originalFile}</span></p>
                                                    <p className="text-gray-300">Sheetåç§°: <span className="text-white">{resultInfo.sheetName}</span></p>
                                                    <p className="text-gray-300">æ€»æ•°æ®è¡Œæ•°: <span className="text-white">{resultInfo.totalRows} è¡Œ</span></p>
                                                    <p className="text-gray-300">æ‹†åˆ†æ•°é‡: <span className="text-white">{resultInfo.tablesCount} ä¸ªæ–‡ä»¶</span></p>
                                                    <p className="text-gray-300">æ¯è¡¨æœ€å¤š: <span className="text-white">{resultInfo.maxRows} è¡Œ</span></p>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {/* æ“ä½œæŒ‰é’® */}
                        <div className="mt-8 flex flex-col sm:flex-row gap-4 justify-center">
                            <button 
                                onClick={handleSplitExcel}
                                disabled={!file || isProcessing || sheets.length === 0}
                                className={`px-8 py-3 rounded-xl font-bold text-white transition-all flex items-center justify-center ${!file || isProcessing || sheets.length === 0 ? 'bg-gray-700 cursor-not-allowed' : 'bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 shadow-lg'}`}
                            >
                                {isProcessing ? (
                                    <>
                                        <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                        </svg>
                                        å¤„ç†ä¸­...
                                    </>
                                ) : (
                                    <>
                                        <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                        </svg>
                                        ä¸€é”®æ‹†åˆ†
                                    </>
                                )}
                            </button>
                            
                            <button 
                                onClick={handleReset}
                                className="px-8 py-3 rounded-xl font-bold text-white bg-gray-800 hover:bg-gray-700 transition-all border border-gray-700 flex items-center justify-center"
                            >
                                <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                é‡ç½®
                            </button>
                        </div>
                    </div>
                    
                    {/* ä½¿ç”¨è¯´æ˜ */}
                    <div className="glass-dark p-6 rounded-2xl">
                        <h3 className="text-xl font-bold text-white mb-4">ä½¿ç”¨è¯´æ˜</h3>
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div className="p-4 bg-slate-800/30 rounded-xl">
                                <div className="w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center mb-3">
                                    <span className="text-blue-400 font-bold">1</span>
                                </div>
                                <h4 className="font-bold text-white mb-2">ä¸Šä¼ Excelæ–‡ä»¶</h4>
                                <p className="text-gray-300 text-sm">æ‹–æ”¾æˆ–ç‚¹å‡»é€‰æ‹©æ‚¨çš„Excelæ–‡ä»¶ï¼Œæ”¯æŒå¤šSheetæ–‡ä»¶</p>
                            </div>
                            <div className="p-4 bg-slate-800/30 rounded-xl">
                                <div className="w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center mb-3">
                                    <span className="text-purple-400 font-bold">2</span>
                                </div>
                                <h4 className="font-bold text-white mb-2">é€‰æ‹©Sheet</h4>
                                <p className="text-gray-300 text-sm">é¢„è§ˆä¸åŒSheetçš„å†…å®¹ï¼Œé€‰æ‹©è¦æ‹†åˆ†çš„Sheet</p>
                            </div>
                            <div className="p-4 bg-slate-800/30 rounded-xl">
                                <div className="w-10 h-10 rounded-full bg-yellow-500/20 flex items-center justify-center mb-3">
                                    <span className="text-yellow-400 font-bold">3</span>
                                </div>
                                <h4 className="font-bold text-white mb-2">é…ç½®æ‹†åˆ†å‚æ•°</h4>
                                <p className="text-gray-300 text-sm">è®¾ç½®æ¯ä¸ªæ‹†åˆ†è¡¨æ ¼çš„æœ€å¤§è¡Œæ•°ï¼ˆåŒ…æ‹¬è¡¨å¤´ï¼‰</p>
                            </div>
                            <div className="p-4 bg-slate-800/30 rounded-xl">
                                <div className="w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center mb-3">
                                    <span className="text-green-400 font-bold">4</span>
                                </div>
                                <h4 className="font-bold text-white mb-2">ä¸‹è½½æ‹†åˆ†ç»“æœ</h4>
                                <p className="text-gray-300 text-sm">ä¸€é”®æ‹†åˆ†å¹¶ä¸‹è½½ZIPå‹ç¼©åŒ…ï¼ŒåŒ…å«æ‰€æœ‰æ‹†åˆ†åçš„æ–‡ä»¶</p>
                            </div>
                        </div>
                    </div>
                    
                    {/* é¡µè„š */}
                    <div className="text-center text-gray-400 text-sm pt-4">
                        <p>Excelæ‹†åˆ†å·¥å…· - æ”¯æŒå¤šSheeté€‰æ‹©é¢„è§ˆï¼Œä½¿ç”¨SheetJSå®ç°</p>
                        <p className="mt-1">æ–‡ä»¶å¤„ç†å®Œå…¨åœ¨æœ¬åœ°è¿›è¡Œï¼Œä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨</p>
                    </div>
                </div>
            );
        }
        
        // æ¸²æŸ“Reactåº”ç”¨
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>